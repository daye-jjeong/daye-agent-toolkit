# vault-memory:sync-agents

> 최근 세션 로그의 결정사항을 스캔하여 AGENTS.md 반영이 필요한 항목을 감지하고 업데이트한다.

**기록 규칙**: `recording-rules.md` 참조

## 트리거

- "정책 동기화", "agents 업데이트", "sync agents"
- `vault-memory:compress` 완료 후 정책성 결정이 감지되면 자동 제안

## 워크플로우

### 1. 세션 로그 스캔

최근 N일(기본 3일)의 `memory/YYYY-MM-DD.md`에서 **결정사항** 섹션을 추출.

각 결정을 분류:
| 유형 | AGENTS.md 반영 | 예시 |
|------|---------------|------|
| 정책/규칙 | ✅ 반영 | "메인 세션에서 exec 금지" |
| 모델/도구 변경 | ✅ 반영 | "primary를 gpt-5.3-codex로 변경" |
| 워크플로우 변경 | ✅ 반영 | "크론 알림은 월~금만" |
| 일회성 작업 결정 | ❌ 스킵 | "이번 스프린트는 2주로" |
| 개인 선호 | ❌ → MEMORY.md | "한국어 기본" |

### 2. AGENTS.md 현재 상태 읽기

`~/clawd/AGENTS.md` 전체를 읽고 섹션 구조 파악:
- § 1: 기본 설정 (초기화, 출력 위생, Python 정책)
- § 2: 세션 보호 (도구 등급, 모델 우선순위, 승인 게이트)
- § 3~: 기타 정책

### 3. 차이 분석 및 제안

각 정책성 결정에 대해:
1. AGENTS.md에 이미 반영돼 있는지 확인
2. 반영 안 돼 있으면 → 어느 섹션에 추가할지 제안
3. 기존 내용과 충돌하면 → 어떤 걸 업데이트할지 제안

출력 형식:
```markdown
## AGENTS.md 동기화 제안

### 새로 추가 (N건)
| # | 세션 | 결정 | → AGENTS.md 섹션 |
|---|------|------|-----------------|
| 1 | 2/10 | primary를 gpt-5.3-codex로 변경 | § 2.2 모델 우선순위 |
| 2 | 2/10 | 탈잉 알림 월~금만 | § 크론 정책 |

### 업데이트 (N건)
| # | 기존 내용 | → 변경 | 출처 |
|---|----------|--------|------|
| 1 | primary: gpt-5.2 | primary: gpt-5.3-codex | 2/10 세션 |

### 이미 반영 (N건) — 스킵
| # | 결정 | 반영 위치 |
|---|------|----------|
| 1 | 한국어 기본 | § 1.2 출력 위생 |
```

### 4. 사용자 확인

- **전체 승인** — 모두 반영
- **N번 수정** — 특정 항목의 섹션/내용 변경
- **N번 제외** — 해당 항목 스킵

### 5. AGENTS.md 업데이트

승인된 항목만 AGENTS.md에 반영:
- 기존 섹션에 추가 또는 기존 내용 업데이트
- `<!-- 출처: YYYY-MM-DD 세션 -->` 주석으로 추적성 확보

### 6. 연계

- **MEMORY.md로 보낼 항목** 발견 시 → `vault-memory:preserve` 제안
- **policy/ 상세 문서** 필요 시 → 생성 제안

## 주의사항

- AGENTS.md 구조(섹션 번호, 계층)를 깨뜨리지 않음
- 기존 정책 삭제는 사용자 명시적 요청 없이 하지 않음
- 충돌 시 사용자에게 선택지 제시
